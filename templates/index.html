<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cilt Kanseri Tahmini</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
    <style>
        /* CSS kodları burada */
    </style>
</head>
<body>
    <div class="container">
        <h1>Cilt Kanseri Tarama Sistemi</h1>
        <form id="uploadForm">
            <input type="file" id="fileInput" accept="image/*" required>
            <div class="cropper-container">
                <img id="image" src="#" alt="Seçilen Resim" style="display: none;">
            </div>
            <button type="button" id="cropBtn" class="btn" style="display: none;">Kırp</button>
            <button type="button" id="predictBtn" class="btn" style="display: none;">Tahmin Et</button>
        </form>
        <div class="result" id="result"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let cropper;
            const fileInput = document.getElementById('fileInput');
            const image = document.getElementById('image');
            const cropBtn = document.getElementById('cropBtn');
            const predictBtn = document.getElementById('predictBtn');
            const resultDiv = document.getElementById('result');

            fileInput.addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        image.src = event.target.result;
                        image.style.display = 'block';

                        if (cropper) {
                            cropper.destroy();
                        }
                        cropper = new Cropper(image, {
                            aspectRatio: 1,
                            viewMode: 1,
                            autoCropArea: 1,
                            responsive: true,
                        });

                        cropBtn.style.display = 'inline-block';
                    };
                    reader.readAsDataURL(file);
                }
            });

            cropBtn.addEventListener('click', function () {
                if (cropper) {
                    const croppedCanvas = cropper.getCroppedCanvas({
                        width: 250,
                        height: 250,
                    });

                    image.src = croppedCanvas.toDataURL();
                    cropper.destroy();
                    predictBtn.style.display = 'inline-block';
                }
            });

            predictBtn.addEventListener('click', function () {
                const croppedCanvas = document.createElement('canvas');
                croppedCanvas.width = 250;
                croppedCanvas.height = 250;
                const ctx = croppedCanvas.getContext('2d');
                ctx.drawImage(image, 0, 0, 250, 250);

                croppedCanvas.toBlob(function (blob) {
                    const formData = new FormData();
                    formData.append('file', blob, 'cropped_image.png');

                    fetch('http://localhost:5000/', {
                        method: 'POST',
                        body: formData,
                    })
                    .then(response => response.json())
                    .then(data => {
                        resultDiv.innerHTML = `<p>Sonuç: <strong>${data.prediction}%</strong></p>`;
                    })
                    .catch(error => {
                        console.error('Hata:', error);
                        resultDiv.innerHTML = `<p style="color: red;">Hata: ${error.message}</p>`;
                    });
                }, 'image/png');
            });
        });
    </script>
</body>
</html>
